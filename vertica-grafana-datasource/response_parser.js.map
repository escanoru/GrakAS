{"version":3,"sources":["../frontend/response_parser.js"],"names":["_","ResponseParser","$q","q","res","data","results","key","queryRes","series","push","target","name","datapoints","points","refId","meta","tables","table","type","length","rowCount","columns","rows","textColIndex","findColIndex","valueColIndex","transformToKeyValueList","transformToSimpleList","i","containsKey","text","value","j","indexOf","map","colName"],"mappings":"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","file":"response_parser.js","sourcesContent":["// Copyright (c) 2019 Micro Focus or one of its affiliates.\n//\n// Licensed under the Apache License, Version 2.0 (the \"License\");\n// you may not use this file except in compliance with the License.\n// You may obtain a copy of the License at\n//\n//    http://www.apache.org/licenses/LICENSE-2.0\n//\n// Unless required by applicable law or agreed to in writing, software\n// distributed under the License is distributed on an \"AS IS\" BASIS,\n// WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n// See the License for the specific language governing permissions and\n// limitations under the License.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a copy\n// of this software and associated documentation files (the \"Software\"), to deal\n// in the Software without restriction, including without limitation the rights\n// to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n// copies of the Software, and to permit persons to whom the Software is\n// furnished to do so, subject to the following conditions:\n//\n// The above copyright notice and this permission notice shall be included in\n// all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n// IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n// FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n// AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n// LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n// OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n// THE SOFTWARE.\n\nimport _ from 'lodash';\n\nexport default class ResponseParser {\n  constructor($q) {\n      this.q = $q\n  }\n\n  processQueryResult(res) {\n    const data = [];\n\n    if (!res.data.results) {\n      return { data: data };\n    }\n\n    for (const key in res.data.results) {\n      const queryRes = res.data.results[key];\n\n      if (queryRes.series) {\n        for (const series of queryRes.series) {\n          data.push({\n            target: series.name,\n            datapoints: series.points,\n            refId: queryRes.refId,\n            meta: queryRes.meta,\n          });\n        }\n      }\n\n      if (queryRes.tables) {\n        for (const table of queryRes.tables) {\n          table.type = 'table';\n          table.refId = queryRes.refId;\n          table.meta = queryRes.meta;\n          data.push(table);\n        }\n      }\n    }\n\n    return { data: data };\n  }\n\n  parseMetricFindQueryResult(refId, results) {\n    if (!results || results.data.length === 0 || results.data.results[refId].meta.rowCount === 0) {\n      return [];\n    }\n\n    const columns = results.data.results[refId].tables[0].columns;\n    const rows = results.data.results[refId].tables[0].rows;\n    const textColIndex = this.findColIndex(columns, '__text');\n    const valueColIndex = this.findColIndex(columns, '__value');\n\n    if (columns.length === 2 && textColIndex !== -1 && valueColIndex !== -1) {\n      return this.transformToKeyValueList(rows, textColIndex, valueColIndex);\n    }\n\n    return this.transformToSimpleList(rows);\n  }\n\n  transformToKeyValueList(rows, textColIndex, valueColIndex) {\n    const res = [];\n\n    for (let i = 0; i < rows.length; i++) {\n      if (!this.containsKey(res, rows[i][textColIndex])) {\n        res.push({\n          text: rows[i][textColIndex],\n          value: rows[i][valueColIndex],\n        });\n      }\n    }\n\n    return res;\n  }\n\n  transformToSimpleList(rows) {\n    const res = [];\n\n    for (let i = 0; i < rows.length; i++) {\n      for (let j = 0; j < rows[i].length; j++) {\n        const value = rows[i][j];\n        if (res.indexOf(value) === -1) {\n          res.push(value);\n        }\n      }\n    }\n\n    return _.map(res, value => {\n      return { text: value };\n    });\n  }\n\n  findColIndex(columns, colName) {\n    for (let i = 0; i < columns.length; i++) {\n      if (columns[i].text === colName) {\n        return i;\n      }\n    }\n\n    return -1;\n  }\n\n  containsKey(res, key) {\n    for (let i = 0; i < res.length; i++) {\n      if (res[i].text === key) {\n        return true;\n      }\n    }\n    return false;\n  }\n\n}\n"]}